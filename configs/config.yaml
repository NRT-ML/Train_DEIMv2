# ========================================
# モデル設定
# ========================================
# 使用するモデル名を指定します。
# 利用可能なモデル:
#
# [DEIMv2シリーズ - DINOv3/HGNetv2バックボーン]
#   - deimv2_hgnetv2_atto_coco  (超軽量: 0.5M params, 0.8 GFLOPs, AP 23.8)
#   - deimv2_hgnetv2_femto_coco (軽量: 1.0M params, 1.7 GFLOPs, AP 31.0)
#   - deimv2_hgnetv2_pico_coco  (小型: 1.5M params, 5.2 GFLOPs, AP 38.5)
#   - deimv2_hgnetv2_n_coco     (N: 3.6M params, 6.8 GFLOPs, AP 43.0)
#   - deimv2_dinov3_s_coco      (S: 9.7M params, 25.6 GFLOPs, AP 50.9)
#   - deimv2_dinov3_m_coco      (M: 18.1M params, 52.2 GFLOPs, AP 53.0)
# ========================================
model: deimv2_hgnetv2_n_coco

num_classes: # 自動計算。実際のクラス数 + 1(背景クラス)
remap_mscoco_category: False  # カスタムデータセットで訓練する場合

output_dir: "./outputs/deimv2_hgnetv2_n_custom_"

# ========================================
# 訓練設定
# ========================================
epochs: 100

# ========================================
# オプティマイザ設定
# ========================================
optimizer:
  type: AdamW           # オプティマイザの種類
  lr: 0.0004            # 学習率（バッチサイズに応じて線形スケーリング推奨）
  betas: [0.9, 0.999]   # Adam/AdamWのbetaパラメータ
  weight_decay: 0.0001  # 重み減衰（L2正則化）

# ========================================
# 訓練データローダー設定
# ========================================
train_dataloader: 
  total_batch_size: 4
  dataset: 
    img_folder: datasets/COCOstyle_small/train                                
    ann_file: datasets/COCOstyle_small/annotations/train_annotations.json 
    transforms:
      ops:
        - {
            "type": "Mosaic",
            "fill_value": 0,
            "max_cached_images": 50,
            # "output_size": # image_sizeから自動設定
            "probability": 1.0,
            "random_pop": True,
            "rotation_range": 10,
            "scaling_range": [0.5, 1.5],
            "translation_range": [0.1, 0.1],
            "use_cache": False,
        } # sizeはimage_sizeから自動設定
        - {"type": "RandomPhotometricDistort", "p": 0.5}
        - {"type": "RandomZoomOut", "fill": 0}
        - {"type": "RandomIoUCrop", "p": 0.8}
        - {"type": "SanitizeBoundingBoxes", "min_size": 1}
        - {"type": "RandomHorizontalFlip"}
        - {"type": "Resize"} # sizeはimage_sizeから自動設定
        - {"type": "SanitizeBoundingBoxes", "min_size": 1}
        - {"type": "ConvertPILImage", "dtype": "float32", "scale": True}
        - {"type": "ConvertBoxes", "fmt": "cxcywh", "normalize": True}

# ========================================
# 検証データローダー設定
# ========================================
val_dataloader: 
  total_batch_size: 4
  dataset:
    img_folder: datasets/COCOstyle_small/val                        
    ann_file: datasets/COCOstyle_small/annotations/val_annotations.json 
    transforms:
      ops:
        - {type: Resize}  # sizeはimage_sizeから自動設定
        - {type: ConvertPILImage, dtype: 'float32', scale: true}
        - {type: ConvertBoxes, fmt: 'cxcywh', normalize: true}